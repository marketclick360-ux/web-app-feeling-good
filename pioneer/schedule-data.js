// Weekly Meeting Schedule Data
// Auto-generated from jw.org
// This file contains midweek and weekend meeting info that auto-updates based on current week.
// All meeting content links back to jw.org for compliance.

const MEETING_SCHEDULE = [
  {
    startDate: "2026-01-05",
    endDate: "2026-01-11",
    weekLabel: "January 5-11, 2026",
    theme: "Jehovah‚Äôs Purpose Will Be Fulfilled",
    scripture:
      "‚ÄúJehovah of armies has sworn: ‚ÄòJust as I have intended, so it will be, and just as I have decided, that is what will come true.‚Äô‚Äù ‚Äî Isaiah 14:24",
    treasuresTalk: "Jehovah‚Äôs Purpose Cannot Be Thwarted",
    watchtowerArticle: "Maintain Your Joy in Old Age",
    watchtowerUrl:
      "https://www.jw.org/en/library/magazines/watchtower-study-november-2025/maintain-your-joy-in-old-age/",
    workbookUrl:
      "https://www.jw.org/en/library/jw-meeting-workbook/january-february-2026-mwb/Life-and-Ministry-Meeting-Schedule-for-January-5-11-2026/",
    keyScriptures: [
      { ref: "Ps. 92:12-14", book: "psalms", chapter: 92 },
      { ref: "Isa. 40:29-31", book: "isaiah", chapter: 40 },
      { ref: "Ps. 37:25", book: "psalms", chapter: 37 },
      { ref: "Job 33:25", book: "job", chapter: 33 },
      { ref: "Isa. 33:24", book: "isaiah", chapter: 33 },
      { ref: "Phil. 4:6, 7", book: "philippians", chapter: 4 }
    ]
  },
  {
    startDate: "2026-01-12",
    endDate: "2026-01-18",
    weekLabel: "January 12-18, 2026",
    theme: "Stay Watchful and Alert",
    scripture:
      "‚ÄúWatchman, what about the night? Watchman, what about the night?‚Äù ‚Äî Isaiah 21:11",
    treasuresTalk: "Be a Watchman in These Last Days",
    watchtowerArticle: "Maintain Your Joy as a Caregiver",
    watchtowerUrl:
      "https://www.jw.org/en/library/magazines/watchtower-study-november-2025/maintain-your-joy-as-a-caregiver/",
    workbookUrl:
      "https://www.jw.org/en/library/jw-meeting-workbook/january-february-2026-mwb/Life-and-Ministry-Meeting-Schedule-for-January-12-18-2026/",
    keyScriptures: [
      { ref: "Gal. 6:2", book: "galatians", chapter: 6 },
      { ref: "Isa. 40:29", book: "isaiah", chapter: 40 },
      { ref: "1 Pet. 5:7", book: "1-peter", chapter: 5 },
      { ref: "Prov. 17:22", book: "proverbs", chapter: 17 },
      { ref: "Job 12:1, 2", book: "job", chapter: 12 },
      { ref: "Job 2:9, 10", book: "job", chapter: 2 },
      { ref: "Jas. 5:11", book: "james", chapter: 5 },
      { ref: "Rom. 8:28", book: "romans", chapter: 8 },
      { ref: "Ps. 34:18, 19", book: "psalms", chapter: 34 }
    ]
  },
  {
    startDate: "2026-02-09",
    endDate: "2026-02-15",
    weekLabel: "February 9-15, 2026",
    theme: "He Is the Stability of Your Times",
    scripture:
      "‚ÄúHe is the stability of your times, an abundance of salvation, wisdom, and knowledge.‚Äù ‚Äî Isaiah 33:6",
    treasuresTalk: "He Is the Stability of Your Times",
    watchtowerArticle:
      "The Book of Job Can Help You When You Give Counsel",
    watchtowerUrl:
      "https://www.jw.org/en/library/magazines/watchtower-study-december-2025/the-book-of-job-can-help-you-when-you-give-counsel/",
    workbookUrl:
      "https://www.jw.org/en/library/jw-meeting-workbook/january-february-2026-mwb/Life-and-Ministry-Meeting-Schedule-for-February-9-15-2026/",
    keyScriptures: [
      { ref: "Job 4:7, 8", book: "job", chapter: 4 },
      { ref: "Job 8:5, 6", book: "job", chapter: 8 },
      { ref: "Job 42:7, 8", book: "job", chapter: 42 },
      { ref: "Prov. 12:18", book: "proverbs", chapter: 12 },
      { ref: "Col. 4:6", book: "colossians", chapter: 4 }
    ]
  },
  {
    startDate: "2026-02-16",
    endDate: "2026-02-22",
    weekLabel: "February 16-22, 2026",
    theme: "Jehovah Will Defend His People",
    scripture:
      "‚ÄúI will defend this city and save it for my own sake and for the sake of my servant David.‚Äù ‚Äî Isaiah 37:35",
    treasuresTalk: "Jehovah Will Defend His People",
    watchtowerArticle: "Imitate Jehovah‚Äôs Humility",
    watchtowerUrl:
      "https://www.jw.org/en/library/magazines/watchtower-study-december-2025/imitate-jehovahs-humility/",
    workbookUrl:
      "https://www.jw.org/en/library/jw-meeting-workbook/january-february-2026-mwb/Life-and-Ministry-Meeting-Schedule-for-February-16-22-2026/",
    keyScriptures: [
      { ref: "Phil. 2:3, 4", book: "philippians", chapter: 2 },
      { ref: "Mic. 6:8", book: "micah", chapter: 6 },
      { ref: "Isa. 57:15", book: "isaiah", chapter: 57 },
      { ref: "Ps. 138:6", book: "psalms", chapter: 138 }
    ]
  },
  {
    startDate: "2026-02-23",
    endDate: "2026-03-01",
    weekLabel: "February 23‚ÄìMarch 1, 2026",
    theme: "Those Hoping in Jehovah Will Regain Power",
    scripture:
      "‚ÄúThose hoping in Jehovah will regain power.‚Äù ‚Äî Isaiah 40:31",
    treasuresTalk: "Those Hoping in Jehovah Will Regain Power",
    watchtowerArticle:
      "How to Plan a Wedding That Brings Honor to Jehovah",
    watchtowerUrl:
      "https://www.jw.org/en/library/magazines/watchtower-study-december-2025/how-to-plan-a-wedding-that-brings-honor-to-jehovah/",
    workbookUrl:
      "https://www.jw.org/en/library/jw-meeting-workbook/january-february-2026-mwb/Life-and-Ministry-Meeting-Schedule-for-February-23-March-1-2026/",
    keyScriptures: [
      { ref: "Phil. 4:5", book: "philippians", chapter: 4 },
      { ref: "Heb. 13:4", book: "hebrews", chapter: 13 },
      { ref: "1 Cor. 7:39", book: "1-corinthians", chapter: 7 },
      { ref: "Prov. 19:2", book: "proverbs", chapter: 19 }
    ]
  }
];

// Track current week index for navigation
let currentWeekIndex = null;

// Helper: parse date string as local time (fixes timezone issues)
function parseLocalDate(dateStr) {
  const [year, month, day] = dateStr.split("-").map(Number);
  // month is 0-indexed in JS
  return new Date(year, month - 1, day, 0, 0, 0, 0);
}

// Function to get the current week's schedule
function getCurrentWeekSchedule() {
  const today = new Date();
  today.setHours(0, 0, 0, 0);

  // If user already navigated to a specific week, keep that
  if (currentWeekIndex !== null && MEETING_SCHEDULE[currentWeekIndex]) {
    return MEETING_SCHEDULE[currentWeekIndex];
  }

  // Otherwise find current week based on dates
  for (let i = 0; i < MEETING_SCHEDULE.length; i++) {
    const week = MEETING_SCHEDULE[i];
    const start = parseLocalDate(week.startDate);
    const end = parseLocalDate(week.endDate);
    // include both start and end dates
    if (today >= start && today <= end) {
      currentWeekIndex = i;
      return week;
    }
  }

  // If all weeks are in the past, default to last week
  const lastWeek = MEETING_SCHEDULE[MEETING_SCHEDULE.length - 1];
  const lastEnd = parseLocalDate(lastWeek.endDate);
  if (today > lastEnd) {
    currentWeekIndex = MEETING_SCHEDULE.length - 1;
    return MEETING_SCHEDULE[currentWeekIndex];
  }

  // If all weeks are in the future, default to first week
  currentWeekIndex = 0;
  return MEETING_SCHEDULE[0];
}

// Navigate to previous or next week
function navigateWeek(direction) {
  if (currentWeekIndex === null) {
    // initialize based on today
    getCurrentWeekSchedule();
  }

  const newIndex = currentWeekIndex + direction;

  if (newIndex >= 0 && newIndex < MEETING_SCHEDULE.length) {
    currentWeekIndex = newIndex;
    renderCurrentSchedule();
  }
}

// Helper: create a jw.org compliance link (HTML anchor tag)
function jwLink(url, text) {
  return `<a href="${url}" target="_blank" rel="noopener noreferrer">${text}</a>`;
}

// Helper: build scripture URL
function scriptureUrl(book, chapter) {
  return `https://www.jw.org/en/library/bible/study-bible/books/${book}/${chapter}/`;
}

// Function to render the schedule on the page
// All jw.org-sourced content is linked back to the original source for compliance
function renderCurrentSchedule() {
  const schedule = getCurrentWeekSchedule();
  const wbUrl = schedule.workbookUrl;
  const wtUrl = schedule.watchtowerUrl;

  // === HEADER SECTION ===
  const weekInfo = document.querySelector(".week-info");
  if (weekInfo) {
    weekInfo.innerHTML = jwLink(wbUrl, "Week of " + schedule.weekLabel);
  }

  const themeElement = document.querySelector(".meeting-theme");
  if (themeElement) {
    themeElement.innerHTML =
      'Midweek Meeting Theme: ' +
      jwLink(wbUrl, '<strong>"' + schedule.theme + '"</strong>');
  }

  const scriptureVerse = document.querySelector(".scripture-verse");
  if (scriptureVerse) {
    scriptureVerse.innerHTML = jwLink(wbUrl, schedule.scripture);
  }

  // === WEEK NAVIGATION BUTTONS ===
  let navButtons = document.querySelector(".week-navigation");
  if (!navButtons) {
    navButtons = document.createElement("div");
    navButtons.className = "week-navigation";
    navButtons.style.cssText =
      "display: flex; gap: 10px; justify-content: center; margin: 15px 0;";

    const prevBtn = document.createElement("button");
    prevBtn.textContent = "‚Üê Previous Week";
    prevBtn.className = "btn-secondary";
    prevBtn.style.cssText =
      "padding: 8px 16px; background: #5B9BD5; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem;";
    prevBtn.onclick = function () {
      navigateWeek(-1);
    };

    const nextBtn = document.createElement("button");
    nextBtn.textContent = "Next Week ‚Üí";
    nextBtn.className = "btn-secondary";
    nextBtn.style.cssText =
      "padding: 8px 16px; background: #5B9BD5; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem;";
    nextBtn.onclick = function () {
      navigateWeek(1);
    };

    navButtons.appendChild(prevBtn);
    navButtons.appendChild(nextBtn);

    // Insert after week-info
    if (weekInfo && weekInfo.parentNode) {
      weekInfo.parentNode.insertBefore(navButtons, weekInfo.nextSibling);
    }
  }

  // Update button states
  const prevBtn = navButtons.querySelector("button:first-child");
  const nextBtn = navButtons.querySelector("button:last-child");
  if (prevBtn) prevBtn.disabled = currentWeekIndex === 0;
  if (nextBtn)
    nextBtn.disabled =
      currentWeekIndex === MEETING_SCHEDULE.length - 1;

  // === MEETING PREP SECTION ===
  const meetingDiv = document.getElementById("meeting");
  if (meetingDiv) {
    const meetingH2 = meetingDiv.querySelector("h2");
    if (meetingH2) {
      meetingH2.innerHTML =
        "üìù " +
        jwLink(
          wbUrl,
          "Meeting Preparation ‚Äî Week of " + schedule.weekLabel
        );
    }

    const meetingContent = meetingDiv.querySelector(".meeting-content");
    if (meetingContent) {
      const paragraphs = meetingContent.querySelectorAll("p");
      if (paragraphs.length >= 1) {
        paragraphs[0].innerHTML =
          "<strong>Main Theme:</strong> " +
          jwLink(
            wbUrl,
            '"' +
              schedule.treasuresTalk +
              '" / "' +
              schedule.theme +
              '"'
          );
      }
    }

    const h3s = meetingDiv.querySelectorAll("h3");
    h3s.forEach(function (h3) {
      if (h3.textContent.includes("Treasures From")) {
        h3.innerHTML = jwLink(
          wbUrl,
          "Treasures From God's Word (10 min)"
        );
      }
      if (h3.textContent.includes("Spiritual Gems")) {
        h3.innerHTML = jwLink(wbUrl, "Spiritual Gems (10 min)");
      }
      if (h3.textContent.includes("Apply Yourself")) {
        h3.innerHTML = jwLink(
          wbUrl,
          "Apply Yourself to the Field Ministry"
        );
      }
      if (h3.textContent.includes("Congregation Bible Study")) {
        h3.innerHTML = jwLink(
          wbUrl,
          "Congregation Bible Study (30 min)"
        );
      }
    });

    const wtArticleEl = meetingDiv.querySelector(".wt-article-title");
    if (wtArticleEl && schedule.watchtowerArticle) {
      wtArticleEl.innerHTML = jwLink(wtUrl, schedule.watchtowerArticle);
    }

    // === KEY SCRIPTURES FOR WATCHTOWER STUDY ===
    const keyScripturesEl = meetingDiv.querySelector(
      ".key-scriptures-list"
    );
    if (
      keyScripturesEl &&
      schedule.keyScriptures &&
      schedule.keyScriptures.length > 0
    ) {
      let html =
        '<strong>Key Scriptures:</strong><ul style="margin-top: 8px;">';
      schedule.keyScriptures.forEach(function (s) {
        const url = scriptureUrl(s.book, s.chapter);
        html += "<li>" + jwLink(url, s.ref) + "</li>";
      });
      html += "</ul>";
      keyScripturesEl.innerHTML = html;
    }
  }

  // === STANDALONE ELEMENTS ===
  const treasuresEl = document.querySelector(".treasures-link");
  if (treasuresEl) {
    treasuresEl.innerHTML = jwLink(
      wbUrl,
      'Treasures Talk: "' + schedule.treasuresTalk + '"'
    );
  }

  const workbookLink = document.querySelector(".workbook-link");
  if (workbookLink) {
    workbookLink.href = wbUrl;
  }

  console.log("Schedule loaded for:", schedule.weekLabel);
}

// Initialize on page load
document.addEventListener("DOMContentLoaded", renderCurrentSchedule);
